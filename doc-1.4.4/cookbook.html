<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/png" href="/assets/img/favicon.ico">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>Liquidsoap</title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
    <!-- Extra details for Live View on GitHub Pages -->
    <!-- Canonical SEO -->
    <link rel="canonical" href="https://www.liquidsoap.info/" />
    <!--  Social tags      -->
    <meta name="keywords" content="radio, audio, video, streaming, icecast, shoutcast">
    <meta name="description" content="Swiss-army knife for multimedia streaming">
    <!-- Schema.org markup for Google+ -->
    <meta itemprop="name" content="Liquidsoap Streaming Language">
    <meta itemprop="description" content="Swiss-army knife for multimedia streaming">
    <!-- Twitter Card data -->
    <meta name="twitter:card" content="product">
    <meta name="twitter:site" content="@LiquidsoapMedia">
    <meta name="twitter:title" content="Liquidsoap Streaming Language">
    <meta name="twitter:description" content="Swiss-army knife for multimedia streaming">
    <meta name="twitter:creator" content="@LiquidsoapMedia">
    <meta name="twitter:image" content="https://www.liquidsoap.info//assets/img/bottle_invert.png">
    <!--     Fonts and icons     -->
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
    <!-- CSS Files -->
    <link href="/assets/css/custom.css" rel="stylesheet" />
    <link href="/assets/css/material-kit.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
    <!-- Documentation extras -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
    <link rel="stylesheet" href="/assets/demo/docs.min.css">
    <style>
    .navbar-absolute-logo {
      padding-left: 45px;
    }

    .navbar-absolute-logo img {
      position: absolute;
      left: 15px;
      margin-top: -6px;
    }

    body {
      background: white;
    }

    p {
        font-size: 16px;
        text-align: justify;
    }
    </style>
    <style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    </style>
  </head>

  <body class="bd-docs" data-spy="scroll" data-target=".bd-sidenav-active">
    <a id="skippy" class="sr-only sr-only-focusable" href="#content">
      <div class="container">
        <span class="skiplink-text">Skip to main content</span>
      </div>
    </a>
    <header class="navbar navbar-expand navbar-dark bg-primary flex-column flex-md-row bd-navbar">
      <a class="navbar-brand mr-0 mr-md-2 navbar-absolute-logo" href="/doc-1.4.4">
        <svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 600 600" focusable="false" style="width: 25px; height: 25px;">
          <title>Liquidsoap</title>
          <style type="text/css">
.st0{fill:#FFFFFF;}
          </style>
          <g>
          <path class="st0" d="M102.4,593.8c-0.7-2.8-3.4-2.5-5.3-3.3c-24.6-10.2-37.2-28.7-37.2-55.6c-0.1-72.1,0-144.2,0-216.3
          c0-52.3,0-104.6,0-156.9c0-37.6,23.1-60.9,60.6-61.1c12-0.1,23.9-0.2,35.9,0c15.7,0.3,26.7,10.1,26.3,23
          c-0.4,12.5-11.1,21.5-26.3,21.8c-12,0.2-23.9-0.1-35.9,0.1c-11.8,0.1-15.6,3.7-15.6,15.3c-0.1,124.4,0,248.8-0.1,373.2
          c0,10.3,4.5,15.1,14.8,15.1c69.1-0.1,138.2,0,207.3-0.1c12.3,0,15.5-3.7,15.5-17.7c0-74.7,0-149.4,0-224.2c0-47.8,0-95.6,0-143.5
          c0-15.2-3-18.1-18.4-18.2c-10.8,0-21.7,0.1-32.5,0c-16-0.2-26.7-9.4-26.6-22.5c0.1-13,10.9-22.1,26.9-22.3
          c13.4-0.2,26.9-0.3,40.3,0.1c30.8,1,54.9,24.5,55,55.2c0.3,127.4,0.3,254.8,0.1,382.2c0,25.5-15.8,45.7-40.2,53.3
          c-1.7,0.5-3.8,0-4.5,2.4C262.3,593.8,182.4,593.8,102.4,593.8z"/>
          <path class="st0" d="M537.4,212.6c-16.8,23-56.5,16.5-68.6-9.5c-8-17.2-12.4-32.7-12-54.5c4.6,4.1,8.3,7.5,12.1,10.7
          c10.3,8.6,21,14,35.5,11.8c12.5-1.9,21.5,6,28.2,16.3c2,3,1.3,7.3,4.8,9.5C537.4,202.2,537.4,207.4,537.4,212.6z"/>
          <path class="st0" d="M200.6,230.4c0-55.3,0-110.5,0-165.8c0-40.7,22.3-62.7,63.2-62.7c50.4,0,100.8,0,151.3,0
          c36.1,0,59.1,21.9,60.4,57.7c0.5,13.1,0.4,26.1,0,39.2c-0.4,15.1-10.1,25.8-22.5,25.7c-12-0.1-21.6-10.1-22.3-24.8
          c-0.6-12.7-0.4-25.4-0.1-38.1c0.2-10.4-4.5-14.9-14.9-14.9c-51.5,0.1-103.1,0-154.6,0.1c-12.7,0-15.5,3.2-15.5,17.5
          c0,105.3,0,210.6,0,316c0,7.8,0.1,15.7,0,23.5c-0.2,17.5-9.4,28.9-23,28.6c-13.5-0.3-21.9-10.9-21.9-28.3
          C200.6,346.2,200.6,288.3,200.6,230.4z"/>
          </g>
        </svg>
        Liquidsoap
      </a>
      <ul class="navbar-nav flex-row d-none d-md-flex">
        <li class="nav-item dropdown">
          <a data-versions="dev 1.4.4 2.1.4 2.2.0 2.2.1 2.2.2 2.2.3
2.2.4 2.2.5
2.3.0" data-version="1.4.4" class="nav-item nav-link dropdown-toggle mr-md-2" href="#" id="liq-version" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            1.4.4
          </a>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="liq-version" id="liq-versions">
          </div>
        </li>
        <li class="nav-item">
          <a class="nav-link p-2" href="https://github.com/savonet/liquidsoap" target="_blank" rel="noopener" aria-label="GitHub">
            <svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 499.36" focusable="false">
              <title>GitHub</title>
              <path d="M256 0C114.64 0 0 114.61 0 256c0 113.09 73.34 209 175.08 242.9 12.8 2.35 17.47-5.56 17.47-12.34 0-6.08-.22-22.18-.35-43.54-71.2 15.49-86.2-34.34-86.2-34.34-11.64-29.57-28.42-37.45-28.42-37.45-23.27-15.84 1.73-15.55 1.73-15.55 25.69 1.81 39.21 26.38 39.21 26.38 22.84 39.12 59.92 27.82 74.5 21.27 2.33-16.54 8.94-27.82 16.25-34.22-56.84-6.43-116.6-28.43-116.6-126.49 0-27.95 10-50.8 26.35-68.69-2.63-6.48-11.42-32.5 2.51-67.75 0 0 21.49-6.88 70.4 26.24a242.65 242.65 0 0 1 128.18 0c48.87-33.13 70.33-26.24 70.33-26.24 14 35.25 5.18 61.27 2.55 67.75 16.41 17.9 26.31 40.75 26.31 68.69 0 98.35-59.85 120-116.88 126.32 9.19 7.9 17.38 23.53 17.38 47.41 0 34.22-.31 61.83-.31 70.23 0 6.85 4.61 14.81 17.6 12.31C438.72 464.97 512 369.08 512 256.02 512 114.62 397.37 0 256 0z" fill="currentColor" fill-rule="evenodd" />
            </svg>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link p-2" href="https://twitter.com/savonet" target="_blank" rel="noopener" aria-label="Twitter">
            <svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 416.32" focusable="false">
              <title>Twitter</title>
              <path d="M160.83 416.32c193.2 0 298.92-160.22 298.92-298.92 0-4.51 0-9-.2-13.52A214 214 0 0 0 512 49.38a212.93 212.93 0 0 1-60.44 16.6 105.7 105.7 0 0 0 46.3-58.19 209 209 0 0 1-66.79 25.37 105.09 105.09 0 0 0-181.73 71.91 116.12 116.12 0 0 0 2.66 24c-87.28-4.3-164.73-46.3-216.56-109.82A105.48 105.48 0 0 0 68 159.6a106.27 106.27 0 0 1-47.53-13.11v1.43a105.28 105.28 0 0 0 84.21 103.06 105.67 105.67 0 0 1-47.33 1.84 105.06 105.06 0 0 0 98.14 72.94A210.72 210.72 0 0 1 25 370.84a202.17 202.17 0 0 1-25-1.43 298.85 298.85 0 0 0 160.83 46.92" fill="currentColor" />
            </svg>
          </a>
        </li>
      </ul>
      <div class="navbar-nav-scroll ml-md-auto ">
        <ul class="navbar-nav bd-navbar-nav flex-row">
          <!--
            <li class="nav-item">
            <a class="nav-link" href=""> <i class="material-icons">card_membership</i> PRO Services </a>
            </li>
          -->
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/savonet/liquidsoap/issues" target="_blank" rel="noopener"><i class="material-icons">star</i> Get Help</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="" target="_blank" rel="noopener"></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="" target="_blank" rel="noopener"></a>
          </li>
        </ul>
      </div>
      <a href="https://github.com/savonet/liquidsoap" class="github-corner" aria-label="View source on Github">
        <svg width="80" height="80" viewBox="0 0 250 250" style="fill:#fff; color:#9c27b0; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
          <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
          <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
          <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
        </svg>
      </a>
      <style>
.github-corner:hover .octo-arm {
  animation: octocat-wave 560ms ease-in-out
}

        @keyframes octocat-wave {
          0%,
          100% {
            transform: rotate(0)
          }
          20%,
          60% {
            transform: rotate(-25deg)
          }
          40%,
          80% {
            transform: rotate(10deg)
          }
        }

        @media (max-width:500px) {
          .github-corner:hover .octo-arm {
            animation: none
          }
          .github-corner .octo-arm {
            animation: octocat-wave 560ms ease-in-out
          }
        }
      </style>
    </header>
    <div class="container-fluid">
      <div class="row flex-xl-nowrap">
        <div class="col-12 col-md-3 col-xl-2 bd-sidebar">
          <nav class="collapse bd-links" id="bd-docs-nav">
            <div class="bd-toc-item active">
              <ul class="nav bd-sidenav">
                <li class="active bd-sidenav-active">
                  <a class="bd-toc-link" href="/doc-1.4.4/install.html">
                    Install
                  </a>
                </li>
                <li class="active bd-sidenav-active">
                  <a class="bd-toc-link" href="#">
                    General tutorials
                  </a>
                </li>
                <li>
                  <a href="/doc-1.4.4/quick_start.html">Quickstart</a></li>
                <li>
                  <a href="/doc-1.4.4/presentations.html">Presentations</a></li>
                <li>
                  <a href="/doc-1.4.4/complete_case.html">Complete case analysis</a></li>
                <li>
                  <a href="/doc-1.4.4/advanced.html">Advanced</a></li>
                <li>
                  <a href="/doc-1.4.4/help.html">How to find help</a></li>
                <li>
                  <a href="/doc-1.4.4/cookbook.html">Cookbook</a></li>
                <li>
                  <a href="/doc-1.4.4/faq.html">Frequently Asked Questions</a></li>
              </ul>
            </div>
            <div class="bd-toc-item active">
              <a class="bd-toc-link" href="#">
                Reference
              </a>
              <ul class="nav bd-sidenav">
                <li>
                  <a href="/doc-1.4.4/reference.html">API reference</a></li>
                <li>
                  <a href="/doc-1.4.4/protocols.html">Protocols</a></li>
                <li>
                  <a href="/doc-1.4.4/settings.html">Settings</a></li>
                <li>
                  <a href="/doc-1.4.4/language.html">Script language</a></li>
                <li>
                  <a href="/doc-1.4.4/encoding_formats.html">Encoding formats</a></li>
                <li>
                  <a href="/doc-1.4.4/playlist_parsers.html">Playlist parsers</a></li>
                <li>
                  <a href="/doc-1.4.4/json.html">JSON import/export</a></li>
                <li>
                  <a href="/doc-1.4.4/ladspa.html">LADSPA plugins</a></li>
              </ul>
            </div>
            <div class="bd-toc-item active">
              <a class="bd-toc-link" href="#">
                Core
              </a>
              <ul class="nav bd-sidenav">
                <li>
                  <a href="/doc-1.4.4/sources.html">Sources</a></li>
                <li>
                  <a href="/doc-1.4.4/clocks.html">Clocks</a></li>
                <li>
                  <a href="/doc-1.4.4/requests.html">Requests</a></li>
                <li>
                  <a href="/doc-1.4.4/stream_content.html">Stream contents</a></li>
                <li>
                  <a href="/doc-1.4.4/script_loading.html">Script loading</a></li>
                <li>
                  <a href="/doc-1.4.4/phases.html">Execution phases</a></li>
              </ul>
            </div>
            <div class="bd-toc-item active">
              <a class="bd-toc-link" href="#">
                Specific tutorials
              </a>
              <ul class="nav bd-sidenav">
                <li>
                  <a href="/doc-1.4.4/blank.html">Blank detection</a></li>
                <li>
                  <a href="/doc-1.4.4/metadata.html">Customize metadata</a></li>
                <li>
                  <a href="/doc-1.4.4/seek.html">Seek and cue support</a></li>
                <li>
                  <a href="/doc-1.4.4/external_decoders.html">External decoders</a></li>
                <li>
                  <a href="/doc-1.4.4/external_streams.html">External streams</a></li>
                <li>
                  <a href="/doc-1.4.4/external_encoders.html">External encoders</a></li>
                <li>
                  <a href="/doc-1.4.4/hls_output.html">HLS output</a></li>
                <li>
                  <a href="/doc-1.4.4/http_input.html">HTTP input</a></li>
                <li>
                  <a href="/doc-1.4.4/harbor.html">Harbor input</a></li>
                <li>
                  <a href="/doc-1.4.4/harbor_http.html">Interaction with the Harbor</a></li>
                <li>
                  <a href="/doc-1.4.4/server.html">Interaction with the server</a></li>
                <li>
                  <a href="/doc-1.4.4/icy_metadata.html">ICY metadata update</a></li>
                <li>
                  <a href="/doc-1.4.4/replay_gain.html">Normalization and replay gain</a></li>
                <li>
                  <a href="/doc-1.4.4/request_sources.html">Requests-based sources</a></li>
                <li>
                  <a href="/doc-1.4.4/shoutcast.html">Shoutcast output</a></li>
                <li>
                  <a href="/doc-1.4.4/dynamic_sources.html">Dynamic source creation</a></li>
                <li>
                  <a href="/doc-1.4.4/crossfade.html">Smart crossfading</a></li>
                <li>
                  <a href="/doc-1.4.4/in_production.html">Using in production</a></li>
                <li>
                  <a href="/doc-1.4.4/flows.html">Liquid Flows</a></li>
                <li>
                  <a href="/doc-1.4.4/video.html">Videos streams</a></li>
              </ul>
              <ul class="nav bd-sidenav">
                <li>
                  <a class="bd-toc-link" href="#">
                    User scripts
                  </a>
                </li>
                <li>
                  <a href="/doc-1.4.4/beets.html">Beets</a></li>
                <li>
                  <a href="/doc-1.4.4/geekradio.html">Geekradio</a></li>
                <li>
                  <a href="/doc-1.4.4/radiopi.html">RadioPi</a></li>
                <li>
                  <a href="/doc-1.4.4/dolebrai.html">Dolebraï</a></li>
                <li>
                  <a href="/doc-1.4.4/frequence3.html">Frequence3</a></li>
                <li>
                  <a href="/doc-1.4.4/radio-nova.html">Listen to Radio Nova</a></li>
                <li>
                  <a href="/doc-1.4.4/video-static.html">Video with a single static image</a></li>
                <li>
                  <a href="/doc-1.4.4/split-cue.html">Split a CUE sheet</a></li>
              </ul>
              <ul class="nav bd-sidenav">
                <li>
                  <a class="bd-toc-link" href="#">
                    Behind the curtains
                  </a>
                </li>
                <li>
                  <a href="/doc-1.4.4/publications.html">Some presentations and publications</a></li>
                <li>
                  <a href="/modules.html">OCaml libraries</a></li>
                <li>
                  <a href="/modules/liquidsoap/index.html">Documentation of some internals</a></li>
                <li class="active bd-sidenav-active">
                  <a class="bd-toc-link" href="/legacy">
                    Legacy website
                  </a>
                </li>
              </ul>
            </div>
          </nav>
        </div>
        <!--
          <div class="d-none d-xl-block col-xl-2 bd-toc">
          <ul class="section-nav">
          <li class="toc-entry toc-h2">
          <a href="#quick-start">Quick start</a>
          <ul>
          <li class="toc-entry toc-h3">
          <a href="#css">CSS</a>
          </li>
          <li class="toc-entry toc-h3">
          <a href="#js">JS</a>
          </li>
          <li class="toc-entry toc-h3">
          <a href="#fonts-and-icons">Fonts and Icons</a>
          </li>
          </ul>
          </li>
          <li class="toc-entry toc-h2">
          <a href="#starter-template">Starter template</a>
          </li>
          </ul>
          </div>
        -->
          <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 bd-content" role="main">
          <h1 id="cookbook"><a href="#cookbook"
class="anchor">Cookbook</a></h1>
<p>The recipes show how to build a source with a particular feature. You
can try short snippets by wrapping the code in an <code>out(..)</code>
operator and passing it directly to liquidsoap:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode liquidsoap"><code class="sourceCode liquidsoap"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>liquidsoap -v &#39;<span class="dt">out</span>(recipe)&#39;</span></code></pre></div>
<p>For longer recipes, you might want to create a short script:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode liquidsoap"><code class="sourceCode liquidsoap"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ot">#!/usr/bin/liquidsoap -v</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="dt">set</span>(<span class="st">&quot;log.file.path&quot;</span>,<span class="st">&quot;/tmp/&lt;script&gt;.log&quot;</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="dt">set</span>(<span class="st">&quot;log.stdout&quot;</span>,<span class="dv">true</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="va">recipe</span> = <span class="co"># &lt;fill this&gt;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="dt">out</span>(recipe)</span></code></pre></div>
<p>See the <a href="quick_start.html">quickstart guide</a> for more
information on how to run <a href="index.html">Liquidsoap</a>, on what
is this <code>out(..)</code> operator, etc.</p>
<h2 id="files"><a href="#files" class="anchor">Files</a></h2>
<p>A source which infinitely repeats the same URI:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode liquidsoap"><code class="sourceCode liquidsoap"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="dt">single</span>(<span class="st">&quot;/my/default.ogg&quot;</span>)</span></code></pre></div>
<p>A source which plays a playlist of requests – a playlist is a file
with an URI per line.</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode liquidsoap"><code class="sourceCode liquidsoap"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Shuffle, play every URI, start over.</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="dt">playlist</span>(<span class="st">&quot;/my/playlist.txt&quot;</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Do not randomize</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="dt">playlist</span>(<span class="va">mode</span>=<span class="st">&quot;normal&quot;</span>, <span class="st">&quot;/my/pl.m3u&quot;</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># The playlist can come from any URI,</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># can be reloaded every 10 minutes.</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="dt">playlist</span>(<span class="va">reload</span>=<span class="dv">600</span>,<span class="st">&quot;http://my/playlist.txt&quot;</span>)</span></code></pre></div>
<p>When building your stream, you’ll often need to make it unfallible.
Usually, you achieve that using a fallback switch (see below) with a
branch made of a safe <code>single</code> or <code>playlist.safe</code>.
Roughly, a single is safe when it is given a valid local audio file. A
<code>playlist.safe</code> behaves just like a playlist but will check
that all files in the playlist are valid local audio files. This is
quite an heavy check, you don’t want to have large safe playlists.</p>
<h2 id="transcoding"><a href="#transcoding"
class="anchor">Transcoding</a></h2>
<p><a href="index.html">Liquidsoap</a> can achieve basic streaming tasks
like transcoding with ease. You input any number of “source” streams
using <code>input.http</code>, and then transcode them to any number of
formats / bitrates / etc. The only limitation is your hardware: encoding
and decoding are both heavy on CPU. Also keep in mind a limitation
inherent to OCaml: one <a href="index.html">Liquidsoap</a> instance can
only use a single processor or core. You can easily work around this
limitation by launching multiple <a href="index.html">Liquidsoap</a>
instances, and thus take advantage of that 8-core Xeon server laying
around in the dust in your garage.</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode liquidsoap"><code class="sourceCode liquidsoap"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Input the stream,</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># from an Icecast server or any other source</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="va">url</span> = <span class="st">&quot;http://streaming.example.com:8000/your-stream.ogg&quot;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="va">input</span> = <span class="dt">mksafe</span>(<span class="dt">input.http</span>(url))</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># First transcoder: MP3 32 kbps</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># We also degrade the samplerate, and encode in mono</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Accordingly, a mono conversion is performed on the input stream</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="dt">output.icecast</span>(</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="ot">%mp3</span>(<span class="va">bitrate</span>=<span class="dv">32</span>, <span class="va">samplerate</span>=<span class="dv">22050</span>, <span class="va">stereo</span>=<span class="dv">false</span>),</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="va">mount</span>=<span class="st">&quot;/your-stream-32.mp3&quot;</span>,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="va">host</span>=<span class="st">&quot;streaming.example.com&quot;</span>, <span class="va">port</span>=<span class="dv">8000</span>, <span class="va">password</span>=<span class="st">&quot;xxx&quot;</span>,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">mean</span>(input))</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Second transcoder : MP3 128 kbps</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="dt">output.icecast</span>(</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="ot">%mp3</span>(<span class="va">bitrate</span>=<span class="dv">128</span>), </span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="va">mount</span>=<span class="st">&quot;/your-stream-128.mp3&quot;</span>,</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="va">host</span>=<span class="st">&quot;streaming.example.com&quot;</span>, <span class="va">port</span>=<span class="dv">8000</span>, <span class="va">password</span>=<span class="st">&quot;xxx&quot;</span>,</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  input)</span></code></pre></div>
<h2 id="re-encoding-a-file"><a href="#re-encoding-a-file"
class="anchor">Re-encoding a file</a></h2>
<p>As a simple example using a fallible output, we shall consider
re-encoding a file. We start by building a source that plays our file
only once. That source is obviously fallible. We pass it to a file
output, which has to be in fallible mode. We also disable the
<code>sync</code> parameter on the source’s clock, to encode the file as
quickly as possible. Finally, we use the <code>on_stop</code> handler to
shutdown liquidsoap when streaming is finished.</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode liquidsoap"><code class="sourceCode liquidsoap"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The input file,</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># any format supported by liquidsoap</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="va">input</span> = <span class="st">&quot;/tmp/input.mp3&quot;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># The output file</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="va">output</span> = <span class="st">&quot;/tmp/output.ogg&quot;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># A source that plays the file once</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="va">source</span> = <span class="dt">once</span>(<span class="dt">single</span>(input))</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a clock with disabled synchronization</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="dt">clock.assign_new</span>(<span class="va">sync</span>=<span class="dv">false</span>,[source])</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Finally, we output the source to an</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co"># ogg/vorbis file</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="dt">output.file</span>(<span class="ot">%vorbis</span>, output,<span class="va">fallible</span>=<span class="dv">true</span>,</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>                     <span class="va">on_stop</span>=shutdown,source)</span></code></pre></div>
<h2 id="scheduling"><a href="#scheduling"
class="anchor">Scheduling</a></h2>
<div class="sourceCode" id="cb7"><pre
class="sourceCode liquidsoap"><code class="sourceCode liquidsoap"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A fallback switch</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="dt">fallback</span>([<span class="dt">playlist</span>(<span class="st">&quot;http://my/playlist&quot;</span>),</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>          <span class="dt">single</span>(<span class="st">&quot;/my/jingle.ogg&quot;</span>)])</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># A scheduler,</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># assuming you have defined the night and day sources</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="dt">switch</span>([ ({<span class="dv">0</span>h<span class="dv">-7</span>h}, night), ({<span class="dv">7</span>h<span class="dv">-24</span>h}, day) ])</span></code></pre></div>
<h2 id="force-a-fileplaylist-to-be-played-at-least-every-xx-minutes"><a
href="#force-a-fileplaylist-to-be-played-at-least-every-xx-minutes"
class="anchor">Force a file/playlist to be played at least every XX
minutes</a></h2>
<p>It can be useful to have a special playlist that is played at least
every 20 minutes for instance (3 times per hour). You may think of a
promotional playlist for instance. Here is the recipe:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode liquidsoap"><code class="sourceCode liquidsoap"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (1200 sec = 20 min)</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="va">timed_promotions</span> = <span class="dt">delay</span>(<span class="fl">1200.</span>,promotions)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="va">main_source</span> = <span class="dt">fallback</span>([timed_promotions,other_source])</span></code></pre></div>
<p>Where promotions is a source selecting the file to be promoted.</p>
<h2 id="handle-special-events-mix-or-switch"><a
href="#handle-special-events-mix-or-switch" class="anchor">Handle
special events: mix or switch</a></h2>
<div class="sourceCode" id="cb9"><pre
class="sourceCode liquidsoap"><code class="sourceCode liquidsoap"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a jingle to your normal source</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># at the beginning of every hour:</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="dt">add</span>([normal,<span class="dt">switch</span>([({<span class="dv">0</span>m0s},jingle)])])</span></code></pre></div>
<p>Switch to a live show as soon as one is available. Make the show
unavailable when it is silent, and skip tracks from the normal source if
they contain too much silence.</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode liquidsoap"><code class="sourceCode liquidsoap"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="va">stripped_stream</span> = </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">strip_blank</span>(<span class="dt">input.http</span>(<span class="st">&quot;http://myicecast:8080/live.ogg&quot;</span>))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="dt">fallback</span>(<span class="va">track_sensitive</span>=<span class="dv">false</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>         [stripped_stream,<span class="dt">skip_blank</span>(normal)])</span></code></pre></div>
<p>Without the <code>track_sensitive=false</code> the fallback would
wait the end of a track to switch to the live. When using the blank
detection operators, make sure to fine-tune their <code>threshold</code>
and <code>length</code> (float) parameters.</p>
<h2 id="unix-interface-dynamic-requests"><a
href="#unix-interface-dynamic-requests" class="anchor">Unix interface,
dynamic requests</a></h2>
<p>Liquidsoap can create a source that uses files provided by the result
of the execution of any arbitrary function of your own. This is
explained in the documentation for <a
href="request_sources.html">request-based sources</a>.</p>
<p>For instance, the following snippet defines a source which repeatedly
plays the first valid URI in the playlist:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode liquidsoap"><code class="sourceCode liquidsoap"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="dt">request.dynamic</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">request.create</span>(<span class="st">&quot;bar:foo&quot;</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>      <span class="va">indicators</span>=</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>        <span class="dt">get_process_lines</span>(<span class="st">&quot;cat &quot;</span>^<span class="dt">quote</span>(<span class="st">&quot;playlist.pls&quot;</span>))) })</span></code></pre></div>
<p>Of course a more interesting behaviour is obtained with a more
interesting program than <code>cat</code>.</p>
<p>Another way of using an external program is to define a new protocol
which uses it to resolve URIs. <code>add_protocol</code> takes a
protocol name, a function to be used for resolving URIs using that
protocol. The function will be given the URI parameter part and the time
left for resolving – though nothing really bad happens if you don’t
respect it. It usually passes the parameter to an external program,
that’s how we use <a href="bubble.html">bubble</a> for example:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode liquidsoap"><code class="sourceCode liquidsoap"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="dt">add_protocol</span>(<span class="st">&quot;bubble&quot;</span>,</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">fun</span> (arg,delay) -&gt;</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">get_process_lines</span>(<span class="st">&quot;/usr/bin/bubble-query &quot;</span>^<span class="dt">quote</span>(arg)))</span></code></pre></div>
<p>When resolving the URI <code>bubble:artist="seed"</code>, liquidsoap
will call the function, which will call
<code>bubble-query 'artist="seed"'</code> which will output 10 lines,
one URI per line.</p>
<h2 id="dynamic-input-with-harbor"><a href="#dynamic-input-with-harbor"
class="anchor">Dynamic input with harbor</a></h2>
<p>The operator <code>input.harbor</code> allows you to receive a source
stream directly inside a running liquidsoap.</p>
<p>It starts a listening server on where any Icecast2-compatible source
client can connect. When a source is connected, its input if fed to the
corresponding source in the script, which becomes available.</p>
<p>This can be very useful to relay a live stream without polling the
Icecast server for it.</p>
<p>An example can be:</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode liquidsoap"><code class="sourceCode liquidsoap"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Serveur settings</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="dt">set</span>(<span class="st">&quot;harbor.bind_addr&quot;</span>,<span class="st">&quot;0.0.0.0&quot;</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># An emergency file</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="va">emergency</span> = <span class="dt">single</span>(<span class="st">&quot;/path/to/emergency/single.ogg&quot;</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># A playlist</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="va">playlist</span> = <span class="dt">playlist</span>(<span class="st">&quot;/path/to/playlist&quot;</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co"># A live source</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="va">live</span> = <span class="dt">input.harbor</span>(<span class="st">&quot;live&quot;</span>,<span class="va">port</span>=<span class="dv">8080</span>,<span class="va">password</span>=<span class="st">&quot;hackme&quot;</span>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co"># fallback</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="va">radio</span> = <span class="dt">fallback</span>(<span class="va">track_sensitive</span>=<span class="dv">false</span>,</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>                 [live,playlist,emergency])</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="co"># output it</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="dt">output.icecast</span>(<span class="ot">%vorbis</span>, radio,<span class="va">mount</span>=<span class="st">&quot;test&quot;</span>,<span class="va">host</span>=<span class="st">&quot;host&quot;</span>)</span></code></pre></div>
<p>This script, when launched, will start a local server, here bound to
“0.0.0.0”. This means that it will listen on any IP address available on
the machine for a connection coming from any IP address. The server will
wait for any source stream on mount point “/live” to login. Then if you
start a source client and tell it to stream to your server, on port
8080, with password “hackme”, the live source will become available and
the radio will stream it immediately.</p>
<h2 id="adding-new-commands"><a href="#adding-new-commands"
class="anchor">Adding new commands</a></h2>
<p>You can add more commands to interact with your script through telnet
or the server socket.</p>
<p>For instance, the following code, available in the standard API,
attaches a <code>source.skip</code> command to a source. It is useful
when the original source do not have a built-in skip command.</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode liquidsoap"><code class="sourceCode liquidsoap"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a skip function to a source</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># when it does not have one</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># by default</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="dt">add_skip_command</span>(s) =</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a> <span class="co"># A command to skip</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a> <span class="kw">def</span> <span class="dt">skip</span>(_) =</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>   <span class="dt">source.skip</span>(s)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>   <span class="st">&quot;Done!&quot;</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a> <span class="kw">end</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a> <span class="co"># Register the command:</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a> <span class="dt">server.register</span>(<span class="va">namespace</span>=<span class="st">&quot;#{source.id(s)}&quot;</span>,</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>                 <span class="va">usage</span>=<span class="st">&quot;skip&quot;</span>,</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>                 <span class="va">description</span>=<span class="st">&quot;Skip the current song.&quot;</span>,</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;skip&quot;</span>,skip)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Attach a skip command to the source s:</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="dt">add_skip_command</span>(s)</span></code></pre></div>
<h2 id="dump-a-stream-into-segmented-files"><a
href="#dump-a-stream-into-segmented-files" class="anchor">Dump a stream
into segmented files</a></h2>
<p>It is sometimes useful (or even legally necessary) to keep a backup
of an audio stream. Storing all the stream in one file can be very
impractical. In order to save a file per hour in wav format, the
following script can be used:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode liquidsoap"><code class="sourceCode liquidsoap"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A source to dump</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># s = ...</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Dump the stream</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="va">file_name</span> = &#39;/archive/$(<span class="kw">if</span> $(title),<span class="st">&quot;$(title)&quot;</span>,<span class="st">&quot;Unknown archive&quot;</span>)-<span class="ot">%Y</span>-<span class="ot">%m</span>-<span class="ot">%d</span>/<span class="ot">%Y</span>-<span class="ot">%m</span>-<span class="ot">%d</span>-<span class="ot">%H</span>_<span class="ot">%M</span>_<span class="ot">%S</span>.mp3&#39;</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="dt">output.file</span>(<span class="ot">%mp3</span>,filename,s)</span></code></pre></div>
<p>This will save your source into a <code>mp3</code> file with name
specified by <code>file_name</code>. In this example, we use <a
href="language.html">string interpolation</a> and time litterals to
generate a different file name each time new metadata are coming from
<code>s</code>.</p>
<h2 id="manually-dump-a-stream"><a href="#manually-dump-a-stream"
class="anchor">Manually dump a stream</a></h2>
<p>You may want to dump the content of a stream. The following code adds
two server/telnet commands, <code>dump.start &lt;filename&gt;</code> and
<code>dump.stop</code> to dump the content of source s into the file
given as argument</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode liquidsoap"><code class="sourceCode liquidsoap"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A source to dump</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># s = (...) </span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># A function to stop</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># the current dump source</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="va">stop_f</span> = <span class="dt">ref</span> (<span class="kw">fun</span> () -&gt; ())</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># You should make sure you never</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co"># do a start when another dump</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co"># is running.</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Start to dump</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="dt">start_dump</span>(file_name) =</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We create a new file output</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># source</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="va">s</span> = <span class="dt">output.file</span>(<span class="ot">%vorbis</span>,</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>            <span class="va">fallible</span>=<span class="dv">true</span>,</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>            <span class="va">on_start</span>={<span class="dt">log</span>(<span class="st">&quot;Starting dump with file #{file_name}.ogg&quot;</span>)},</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>            <span class="va">reopen_on_metadata</span>=<span class="dv">false</span>,</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;#{file_name}&quot;</span>,</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>            s)</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We update the stop function</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  stop_f := <span class="kw">fun</span> () -&gt; <span class="dt">source.shutdown</span>(s)</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Stop dump</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="dt">stop_dump</span>() =</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>  <span class="va">f</span> = !stop_f</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>  <span class="dt">f</span> ()</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Some telnet/server command</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a><span class="dt">server.register</span>(<span class="va">namespace</span>=<span class="st">&quot;dump&quot;</span>,</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>                <span class="va">description</span>=<span class="st">&quot;Start dumping.&quot;</span>,</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>                <span class="va">usage</span>=<span class="st">&quot;dump.start &lt;filename&gt;&quot;</span>,</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;start&quot;</span>,</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>                <span class="kw">fun</span> (s) -&gt;  <span class="kw">begin</span> <span class="dt">start_dump</span>(s) <span class="st">&quot;Done!&quot;</span> <span class="kw">end</span>)</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a><span class="dt">server.register</span>(<span class="va">namespace</span>=<span class="st">&quot;dump&quot;</span>,</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>                <span class="va">description</span>=<span class="st">&quot;Stop dumping.&quot;</span>,</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>                <span class="va">usage</span>=<span class="st">&quot;dump.stop&quot;</span>,</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;stop&quot;</span>,</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>                <span class="kw">fun</span> (s) -&gt; <span class="kw">begin</span> <span class="dt">stop_dump</span>() <span class="st">&quot;Done!&quot;</span> <span class="kw">end</span>)</span></code></pre></div>
<h2 id="transitions"><a href="#transitions"
class="anchor">Transitions</a></h2>
<p>There are two kinds of transitions. Transitions between two different
children of a switch are not problematic. Transitions between different
tracks of the same source are more tricky, since they involve a fast
forward computation of the end of a track before feeding it to the
transition function: such a thing is only possible when only one
operator is using the source, otherwise it’ll get out of sync.</p>
<h3 id="switch-based-transitions"><a href="#switch-based-transitions"
class="anchor">Switch-based transitions</a></h3>
<p>The switch-based operators (<code>switch</code>,
<code>fallback</code> and <code>random</code>) support transitions. For
every child, you can specify a transition function computing the output
stream when moving from one child to another. This function is given two
<code>source</code> parameters: the child which is about to be left, and
the new selected child. The default transition is
<code>fun (a,b) -&gt; b</code>, it simply relays the new selected child
source.</p>
<p>Transitions have limited duration, defined by the
<code>transition_length</code> parameter. Transition duration can be
overriden by passing a metadata. Default field for it is
<code>"liq_transition_length"</code> but it can also be set to a
different value via the <code>override</code> parameter.</p>
<p>Here are some possible transition functions:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode liquidsoap"><code class="sourceCode liquidsoap"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A simple (long) cross-fade</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Use metadata override to make sure transition is long enough.</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="dt">crossfade</span>(a,b)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> <span class="dt">add_transition_length</span>(_) =</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    [(<span class="st">&quot;liq_transition_length&quot;</span>,<span class="st">&quot;15.&quot;</span>)]</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="va">transition</span> =</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">add</span>(<span class="va">normalize</span>=<span class="dv">false</span>,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>          [ <span class="dt">sequence</span>([ <span class="dt">blank</span>(<span class="va">duration</span>=<span class="fl">5.</span>),</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>                       <span class="dt">fade.in</span>(<span class="va">duration</span>=<span class="fl">10.</span>,b) ]),</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fade.out</span>(<span class="va">duration</span>=<span class="fl">10.</span>,a) ])</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Transition can have multiple tracks so only pass the metadata</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># once.</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">map_first_track</span>(<span class="dt">map_metadata</span>(add_transition_length),transition)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Partially apply next to give it a jingle source.</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="co"># It will fade out the old source, then play the jingle.</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="co"># At the same time it fades in the new source.</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Use metadata override to make sure transition is long enough.</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="dt">next</span>(j,a,b)</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This assumes that the jingle is 6 seconds long</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> <span class="dt">add_transition_length</span>(_) =</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>    [(<span class="st">&quot;liq_transition_length&quot;</span>,<span class="st">&quot;15.&quot;</span>)]</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>  <span class="va">transition</span> =</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>    <span class="dt">add</span>(<span class="va">normalize</span>=<span class="dv">false</span>,</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>      [ <span class="dt">sequence</span>(<span class="va">merge</span>=<span class="dv">true</span>,</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>                 [ <span class="dt">blank</span>(<span class="va">duration</span>=<span class="fl">3.</span>),</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>                   <span class="dt">fade.in</span>(<span class="va">duration</span>=<span class="fl">6.</span>,b) ]),</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>        <span class="dt">sequence</span>([<span class="dt">fade.out</span>(<span class="va">duration</span>=<span class="fl">9.</span>,a),</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>                  j,<span class="dt">blank</span>()]) ])</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>  <span class="dt">map_first_track</span>(<span class="dt">map_metadata</span>(add_transition_length),transition)</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a><span class="co"># A transition, which does a cross-fading from A to B</span></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a><span class="co"># No need to override duration as default value (5 seconds)</span></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a><span class="co"># is over crossade duration (3 seconds)</span></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="dt">transition</span>(j,a,b)</span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>  <span class="dt">add</span>(<span class="va">normalize</span>=<span class="dv">false</span>,</span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>      [ <span class="dt">fade.in</span>(<span class="va">duration</span>=<span class="fl">3.</span>,b),</span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fade.out</span>(<span class="va">duration</span>=<span class="fl">3.</span>,a) ])</span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>Finally, we build a source which plays a playlist, and switches to
the live show as soon as it starts, using the <code>transition</code>
function as a transition. At the end of the live, the playlist comes
back with a cross-fading.</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode liquidsoap"><code class="sourceCode liquidsoap"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="dt">fallback</span>(<span class="va">track_sensitive</span>=<span class="dv">false</span>,</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>         <span class="va">transitions</span>=[ crossfade, <span class="dt">transition</span>(jingle) ],</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>         [ <span class="dt">input.http</span>(<span class="st">&quot;http://localhost:8000/live.ogg&quot;</span>),</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>           <span class="dt">playlist</span>(<span class="st">&quot;playlist.pls&quot;</span>) ])</span></code></pre></div>
<h3 id="cross-based-transitions"><a href="#cross-based-transitions"
class="anchor">Cross-based transitions</a></h3>
<p>The <code>cross()</code> operator allows arbitrary transitions
between tracks of a same source. Here is how to use it in order to get a
cross-fade:</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode liquidsoap"><code class="sourceCode liquidsoap"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="dt">crossfade</span>(<span class="va">~start_next</span>,<span class="va">~fade_in</span>,<span class="va">~fade_out</span>,s)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="va">fade.in</span> = <span class="dt">fade.in</span>(<span class="va">duration</span>=fade_in)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="va">fade.out</span> = <span class="dt">fade.out</span>(<span class="va">duration</span>=fade_out)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="va">fader</span> = <span class="kw">fun</span> (_,_,_,_,a,b) -&gt; <span class="dt">add</span>(<span class="va">normalize</span>=<span class="dv">false</span>,[<span class="dt">fade.in</span>(b),<span class="dt">fade.out</span>(a)])</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">cross</span>(<span class="va">duration</span>=start_next,fader,s)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="va">my_source</span> =</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">crossfade</span>(<span class="va">start_next</span>=<span class="fl">1.</span>,<span class="va">fade_out</span>=<span class="fl">1.</span>,<span class="va">fade_in</span>=<span class="fl">1.</span>,my_source)</span></code></pre></div>
<p>The <code>crossfade()</code> function is already in liquidsoap.
Unless you need a custom one, you should never have to copy the above
example. It is implemented in the scripting language, much like this
example. You can find its code in <code>utils.liq</code>.</p>
<p>The fade-in and fade-out parameters indicate the duraction of the
fading effects. The start-next parameters tells how much overlap there
will be between the two tracks. If you want a long cross-fading with a
smaller overlap, you should use a sequence to stick some blank section
before the beginning of <code>b</code> in <code>fader</code>. The three
parameters given here are only default values, and will be overriden by
values coming from the metadata tags <code>liq_fade_in</code>,
<code>liq_fade_out</code> and <code>liq_start_next</code>.</p>
<p>For an advanced crossfading function, you can see the <a
href="crossfade.html">crossfade documentation</a></p>
<h2 id="alsa-unbuffered-output"><a href="#alsa-unbuffered-output"
class="anchor">Alsa unbuffered output</a></h2>
<p>You can use <a href="index.html">Liquidsoap</a> to capture and play
through alsa with a minimal delay. This particulary useful when you want
to run a live show from your computer. You can then directly capture and
play audio through external speakers without delay for the DJ !</p>
<p>This configuration is not trivial since it relies on your hardware.
Some hardware will allow both recording and playing at the same time,
some only one at once, and some none at all.. Those note to configure
are what works for us, we don’t know if they’ll fit all hardware.</p>
<p>First launch liquidsoap as a one line program</p>
<pre><code>liquidsoap -v --debug &#39;input.alsa(bufferize=false)&#39;</code></pre>
<p>Unless you’re lucky, the logs are full of lines like the
following:</p>
<pre><code>Could not set buffer size to &#39;frame.size&#39; (1920 samples), got 2048.</code></pre>
<p>The solution is then to fix the captured frame size to this value,
which seems specific to your hardware. Let’s try this script:</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode liquidsoap"><code class="sourceCode liquidsoap"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set correct frame size:</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="dt">set</span>(<span class="st">&quot;frame.audio.size&quot;</span>,<span class="dv">2048</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="va">input</span> = <span class="dt">input.alsa</span>(<span class="va">bufferize</span>=<span class="dv">false</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="dt">output.alsa</span>(<span class="va">bufferize</span>=<span class="dv">false</span>,input)</span></code></pre></div>
<p>If everything goes right, you may hear on your output the captured
sound without any delay ! If you want to test the difference, just run
the same script with <code>bufferize=true</code> (or without this
parameter since it is the default). The setting will be acknowledged in
the log as follows:</p>
<pre><code>Targetting &#39;frame.audio.size&#39;: 2048 audio samples = 2048 ticks.</code></pre>
<p>If you experience problems it might be a good idea to double the
value of the frame size. This increases stability, but also latency.</p>
          <div id="footer"></div>
        </main>
      </div>
    </div>
    <!--   Core JS Files   -->

    <script src="/assets/js/core/jquery.min.js" type="text/javascript"></script>
    <script src="/assets/js/core/popper.min.js" type="text/javascript"></script>
    <script src="/assets/js/core/bootstrap-material-design.min.js" type="text/javascript"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript"></script>
    <script src="/assets/js/liq-jquery.js" type="text/javascript"></script>
  </body>

</html>
